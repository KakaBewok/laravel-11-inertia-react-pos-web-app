import{r as f,j as e,y as b}from"./app-vVRCAGOW.js";import{B as v}from"./button-cqbvmE_O.js";import{o as R,s as g,f as S,h as G,j as K,k as H,u as z,t as O,F as X,a as m,b as u,c as p,d,e as h,T as Y,l as Z}from"./index-CY1qIC-V.js";import{H as J}from"./heading-w8uDzKiO.js";import{I as k}from"./input-DGDJBCOL.js";import{S as P,a as T,b as E,d as A,e as y}from"./select-CBZcddK2.js";import{u as Q}from"./useGlobalContext-WqwPRLsa.js";import{B as W}from"./react-toastify.esm-CR37Gj2I.js";import{A as D,M as w,u as ee}from"./config-BrmZX2t1.js";import"./index-MU7vlc2G.js";import"./utils-CcFn7B-c.js";import"./clsx-B-dksMZM.js";import"./index-GR9MXyJ6.js";import"./react-icons.esm-PTXMq6VF.js";import"./index-Ba5YF6YM.js";import"./index-DHhLAQoV.js";import"./index-CvUxNp2A.js";import"./index-DoEqfaoL.js";import"./index-BN_t88yI.js";import"./index-CGT5Zpqz.js";import"./index-CiLFz9Bf.js";const se=R({name:g().min(3,{message:"Name must contain at least 3 character(s)"}),price:S.number().min(0,{message:"Price must be greater than or equal to 0"}),category_id:g().min(1,{message:"Category is required"}),description:g().optional(),unit:g().min(1,{message:"Unit is required"}),stock_quantity:S.number().min(0,{message:"Stock must be greater than or equal to 0"}),photos:G(K([H(File).refine(s=>D.includes(s.type),{message:" must be jpg, jpeg, png or webp formats"}).refine(s=>s.size<=w*1024,{message:` is more than ${w}KB`}),g()])).optional()}),ve=({initialData:s,categories:_})=>{const[i,j]=f.useState([]),n=f.useRef(null),{loading:l,setLoading:F}=Q(),[I,C]=f.useState(!1),V=s?"Edit product":"Create product",U=s?"Edit a product":"Add a new product",q=s?"Product updated.":"Product created.",$=s?"Save changes":"Create",c=z({resolver:O(se),defaultValues:{name:(s==null?void 0:s.name)||"",price:(s==null?void 0:s.price)||0,category_id:(s==null?void 0:s.category_id)||"",description:(s==null?void 0:s.description)||"",unit:(s==null?void 0:s.unit)||"",stock_quantity:(s==null?void 0:s.stock_quantity)||0,photos:s==null?void 0:s.photos}});f.useEffect(()=>{(async()=>{if(s&&s.photos.length>0){const o=await Promise.all(s.photos.map((a,x)=>{const N=`undefined/storage/${a}`;return ee(N,`product-image-${x}.jpg`,"image/jpeg")}));j(o);const t=new DataTransfer;o.forEach(a=>t.items.add(a)),n.current&&(n.current.files=t.files),c.setValue("photos",o)}})()},[s,c]);const B=r=>{if(r.target.files){const o=Array.from(r.target.files);j([...i,...o]),c.setValue("photos",[...i,...o])}},L=r=>{const o=i.filter((a,x)=>x!==r);j(o);const t=new DataTransfer;o.forEach(a=>t.items.add(a)),n.current&&(n.current.files=t.files),c.setValue("photos",o)},M=r=>{F(!0);const o=()=>{c.reset(),j([]),n.current&&(n.current.value="")},t=()=>{o(),I?b.visit(route("admin.product.create")):b.visit(route("admin.product.index")),setTimeout(()=>{W.success(q,{position:"top-center"})},1e3)},a=N=>{console.log("An error occurred: ",N)},x=()=>F(!1);s?b.post(route("admin.product.update",s==null?void 0:s.id),{...r,_method:"PATCH"},{onSuccess:t,onError:a,onFinish:x}):b.post(route("admin.product.store"),r,{onSuccess:t,onError:a,onFinish:x})};return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(J,{title:V,description:U}),e.jsx(v,{variant:"outline",onClick:()=>window.history.back(),className:"dark:bg-slate-200 dark:text-slate-900",children:"Back"})]}),e.jsx(X,{...c,children:e.jsxs("form",{onSubmit:c.handleSubmit(M),className:"w-full p-8 space-y-8 rounded-md bg-slate-50 dark:bg-gradient-to-tr md:dark:bg-gradient-to-br dark:from-slate-950 dark:via-slate-900 dark:to-slate-800",children:[e.jsxs("div",{className:"grid grid-cols-1 gap-4 md:gap-8 md:grid-cols-2",children:[e.jsx(m,{control:c.control,name:"name",render:({field:r,fieldState:o})=>e.jsxs(u,{children:[e.jsxs(p,{className:o.error?"text-red-500":"dark:text-gray-300",children:["Name"," ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx(d,{children:e.jsx(k,{className:"dark:bg-slate-700",disabled:l,placeholder:"Arabica coffe beans",...r})}),e.jsx(h,{className:"dark:text-red-500"})]})}),e.jsx(m,{control:c.control,name:"price",render:({field:r,fieldState:o})=>e.jsxs(u,{children:[e.jsx(p,{className:o.error?"text-red-500":"dark:text-gray-300",children:"Price"}),e.jsx(d,{children:e.jsx(k,{className:"dark:bg-slate-700",type:"number",disabled:l,...r})}),e.jsx(h,{className:"dark:text-red-500"})]})}),e.jsx(m,{control:c.control,name:"category_id",render:({field:r,fieldState:o})=>e.jsxs(u,{children:[e.jsxs(p,{className:o.error?"text-red-500":"dark:text-gray-300",children:["Category"," ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs(P,{disabled:l,onValueChange:r.onChange,value:r.value.toString(),defaultValue:r.value.toString(),children:[e.jsx(d,{className:"dark:bg-slate-700",children:e.jsx(T,{className:"w-full",children:e.jsx(E,{defaultValue:r.value.toString(),placeholder:"Select a category"})})}),e.jsx(A,{children:_.map(t=>e.jsx(y,{value:t.id.toString(),children:t.name},t.id.toString()))})]}),e.jsx(h,{className:"dark:text-red-500"})]})}),e.jsx(m,{control:c.control,name:"unit",render:({field:r,fieldState:o})=>e.jsxs(u,{children:[e.jsxs(p,{className:o.error?"text-red-500":"dark:text-gray-300",children:["Unit"," ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx(d,{children:e.jsxs(P,{disabled:l,onValueChange:r.onChange,value:r.value,defaultValue:r.value,children:[e.jsx(d,{className:"dark:bg-slate-700",children:e.jsx(T,{className:"w-full",children:e.jsx(E,{defaultValue:r.value,placeholder:"Select a unit"})})}),e.jsxs(A,{children:[e.jsx(y,{value:"Gram",children:"Gram"}),e.jsx(y,{value:"Kilogram",children:"Kilogram"}),e.jsx(y,{value:"Pcs",children:"Pcs"})]})]})}),e.jsx(h,{className:"dark:text-red-500"})]})}),e.jsx(m,{control:c.control,name:"stock_quantity",render:({field:r,fieldState:o})=>e.jsxs(u,{children:[e.jsx(p,{className:o.error?"text-red-500":"dark:text-gray-300",children:"Stock"}),e.jsx(d,{children:e.jsx(k,{className:"dark:bg-slate-700",type:"number",disabled:l,...r})}),e.jsx(h,{className:"dark:text-red-500"})]})}),e.jsx(m,{control:c.control,name:"description",render:({field:r,fieldState:o})=>e.jsxs(u,{children:[e.jsx(p,{className:o.error?"text-red-500":"dark:text-gray-300",children:"Description"}),e.jsx(d,{children:e.jsx(Y,{className:"w-full h-32 max-w-lg max-h-40 dark:bg-slate-700",disabled:l,placeholder:"Description of Arabica coffe beans like size, color etc.",...r})}),e.jsx(h,{className:"dark:text-red-500"})]})})]}),e.jsxs("div",{className:"flex flex-col gap-8",children:[e.jsx(m,{control:c.control,name:"photos",render:({fieldState:r})=>e.jsxs(u,{children:[e.jsx(p,{className:r.error?"text-red-500":"dark:text-gray-300",children:"Product Images"}),e.jsxs(Z,{children:["Upload each image up to ",w,"KB (jpg, jpeg, png, webp only)."]}),e.jsx(d,{children:e.jsx(k,{className:"w-full md:w-[48%] dark:bg-slate-700",ref:n,type:"file",multiple:!0,accept:"image/jpeg, image/png, image/jpg, image/webp",onChange:B})}),r.error&&e.jsx("ul",{className:"flex flex-col gap-6 py-2 text-sm text-red-500 md:gap-3",children:(Array.isArray(r.error)?r.error:[r.error]).map((o,t)=>e.jsx("li",{children:`- Image number ${t+1} ${(o==null?void 0:o.message)||"Unknown error"}`},t))})]})}),e.jsx("div",{className:"flex flex-wrap items-center justify-center gap-8 md:justify-start",children:i.map((r,o)=>e.jsxs("div",{className:"relative overflow-hidden border rounded-md shadow-md dark:border-gray-200 border-slate-300 w-52 h-52",children:[e.jsx("img",{src:URL.createObjectURL(r),alt:`Uploaded ${o}`,className:"object-cover w-full h-full"},o),e.jsx("button",{className:"absolute flex items-center justify-center w-6 h-6 text-white bg-red-500 rounded-full top-2 right-2",type:"button",onClick:()=>L(o),children:e.jsx("span",{className:"text-xs leading-none",children:"âœ•"})})]},o))})]}),e.jsxs("div",{className:"flex flex-col items-center justify-between w-full gap-4 mt-10 md:w-1/2 lg:flex-row",children:[e.jsx(v,{disabled:l,className:"w-full",type:"submit",onClick:()=>C(!1),children:$}),e.jsx(v,{disabled:l,className:"w-full bg-slate-300 text-slate-950 hover:bg-slate-200 dark:bg-slate-700 dark:text-slate-200",type:"submit",onClick:()=>C(!0),children:"Create & Create another"})]})]})})]})};export{ve as ProductForm};
