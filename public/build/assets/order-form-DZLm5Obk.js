import{r as c,j as e,y as N}from"./app-CBjwQAxT.js";import{B as y}from"./button-DEL8svb2.js";import{P as ae,a as oe,C as ne,b as de,c as le}from"./popover-DsBSHetn.js";import{o as ce,s as b,g as me,f as O,h as ue,u as he,t as xe,F as ie,a as i,b as g,c as j,d as u,e as p}from"./index-CQEWkbnh.js";import{H as ge}from"./heading-BmbMu-Jf.js";import{I as w}from"./input-Cdi3gyGp.js";import{S as E,a as M,b as B,d as J,e as k}from"./select-DYtbBsWu.js";import{T as je}from"./textarea-Bi3kMldu.js";import{u as pe}from"./useGlobalContext-WPfucgOM.js";import{c as fe}from"./utils-CcFn7B-c.js";import{B as ye}from"./react-toastify.esm-CFj9e9l2.js";import be from"./order-summary-_Jylj8fP.js";import Ne from"./product-cards-DWYPs0gR.js";import{QrModal as ke}from"./qr-modal-DMvZrkLB.js";import{BankTransferCard as Se}from"./bank-transfer-card-UUoqDr_m.js";import{f as ve}from"./format-BEMO4FpZ.js";import"./index-DCAHNd6M.js";import"./createLucideIcon-DrjK5DNx.js";import"./react-icons.esm-TIWuvnpV.js";import"./index-DxLAwLwW.js";import"./index-BtB2tnuv.js";import"./index-DJL5S_DW.js";import"./index-H3tww2bM.js";import"./index-BTEjy6hw.js";import"./clsx-B-dksMZM.js";import"./separator-Bd8Miyvu.js";import"./image-not-found-BCeE-Ta1.js";import"./constants-BUrVtmhx.js";const Ce=ce({customer_name:b().min(3,{message:"Name must contain at least 3 character(s)"}),order_date:me().refine(a=>{const m=new Date;m.setHours(0,0,0,0);const h=new Date(m);return h.setDate(m.getDate()+1),a<h},{message:"Order date cannot be tomorrow or in the future."}),total_amount:O.number().min(0,{message:"Total amount must be greater than or equal to 0"}),changes:O.number().min(0,{message:"Changes must be greater than or equal to 0"}),status:b().min(3,{message:"Status must contain at least 3 character(s)"}),notes:b().optional(),payment_method_id:b().min(1,{message:"Payment method is required"}),products:ue(b().min(2))}),et=({initialData:a,paymentMethods:m,products:h})=>{const{loading:x,setLoading:I}=pe(),[F,S]=c.useState(null),[A,P]=c.useState(!1),[Q,H]=c.useState(0),[V,L]=c.useState(0),[d,f]=c.useState([]),[T,$]=c.useState(""),R=h.filter(t=>t.name.toLowerCase().includes(T.toLowerCase())),[z,q]=c.useState(!1),G=a?"Edit order":"Create order",K=a?"Edit an order":"Add a new order",U=a?"Order updated.":"Order created.",W=a?"Save changes":"Create",v={customer_name:"",order_date:new Date,total_amount:V,changes:0,status:"",notes:"",payment_method_id:""},n=he({resolver:xe(Ce),defaultValues:{customer_name:(a==null?void 0:a.customer_name)||"",order_date:(a==null?void 0:a.order_date)||new Date,total_amount:(a==null?void 0:a.total_amount)||V,changes:(a==null?void 0:a.changes)||0,status:(a==null?void 0:a.status)||"",notes:(a==null?void 0:a.notes)||"",payment_method_id:(a==null?void 0:a.payment_method_id)||""}}),C=n.watch(),X=t=>{I(!0);const r=()=>{n.reset(),localStorage.removeItem("selectedItems"),localStorage.removeItem("formData"),localStorage.removeItem("paymentMethodName")},s=()=>{r(),z?N.visit(route("admin.order.create")):N.visit(route("admin.order.index")),setTimeout(()=>{ye.success(U,{position:"top-center"})},1e3)},o=_=>{console.log("An error occurred: ",_)},l=()=>I(!1);a?N.post(route("admin.order.update",a==null?void 0:a.id),{...t,_method:"PATCH"},{onSuccess:s,onError:o,onFinish:l}):N.post(route("admin.order.store"),t,{onSuccess:s,onError:o,onFinish:l})},Y=t=>{const r=m.find(s=>s.id.toString()===t);S((r==null?void 0:r.name)??null)},Z=(t,r)=>{const s=h.find(o=>o.id==t.id);s&&f(d.map(o=>{if(o.id===t.id){let l=o.stock_quantity+r;return l=Math.min(l,s.stock_quantity),l=Math.max(l,0),{...o,stock_quantity:l}}return o}).filter(o=>o.stock_quantity>0))},D=t=>{const r=d.find(s=>s.id===t.id);f(r?d.map(s=>s.id===t.id?{...s,stock_quantity:Math.min(s.stock_quantity+1,t.stock_quantity)}:s):[...d,{...t,stock_quantity:1}])},ee=t=>{f(d.filter(r=>r.id!==t.id))};c.useEffect(()=>{const t=d.reduce((s,o)=>s+o.price*o.stock_quantity,0),r=d.reduce((s,o)=>s+o.stock_quantity,0);n.setValue("total_amount",t),L(t),H(r)},[d,n.setValue]),c.useEffect(()=>{const t=localStorage.getItem("selectedItems"),r=localStorage.getItem("formData"),s=localStorage.getItem("paymentMethodName");if(t){const l=JSON.parse(t).filter(_=>h.some(re=>re.id===_.id));f(l)}if(r){const o=JSON.parse(r);o.order_date&&(o.order_date=new Date(o.order_date)),n.reset(o)}s&&S(JSON.parse(s)??null)},[]),c.useEffect(()=>{localStorage.setItem("selectedItems",JSON.stringify(d)),localStorage.setItem("formData",JSON.stringify(C)),localStorage.setItem("paymentMethodName",JSON.stringify(F))},[d,C]);const te=Object.keys(v).every(t=>{const r=v[t],s=C[t];return r instanceof Date&&s instanceof Date?r.toDateString()===s.toDateString():s===r}),se=()=>{n.reset(v),S("")};return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(ge,{title:G,description:K}),e.jsx(y,{variant:"outline",onClick:()=>window.history.back(),className:"dark:bg-slate-200 dark:text-slate-900",children:"Back"})]}),e.jsx(Ne,{searchTerm:T,setSearchTerm:$,filteredProducts:R,addItem:D}),e.jsx(ie,{...n,children:e.jsx("form",{onSubmit:n.handleSubmit(X),className:"w-full p-8 space-y-8 rounded-md bg-slate-50 dark:bg-gradient-to-tr md:dark:bg-gradient-to-br dark:from-slate-950 dark:via-slate-900 dark:to-slate-800",children:e.jsxs("div",{className:"grid w-full grid-cols-1 gap-4 md:gap-20 md:grid-cols-2",children:[e.jsx(be,{products:h,selectedItems:d,setSelectedItems:f,adjustQuantity:Z,removeItem:ee,totalItems:Q,form:n}),e.jsxs("div",{className:"flex flex-col w-full gap-4",children:[e.jsx("div",{className:"mb-4",children:e.jsxs("div",{className:"flex items-baseline justify-between",children:[e.jsx("h1",{className:"text-lg font-bold ",children:"Form Checkout"}),e.jsx(y,{type:"button",size:"sm",variant:"outline",onClick:()=>se(),className:`${te?"hidden":""} text-white bg-red-500 hover:bg-red-500 hover:text-white hover:opacity-85`,children:"Clear Form"})]})}),e.jsx(i,{control:n.control,name:"customer_name",render:({field:t,fieldState:r})=>e.jsxs(g,{children:[e.jsxs(j,{className:r.error?"text-red-500":"dark:text-gray-300",children:["Customer name",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx(u,{children:e.jsx(w,{className:"dark:bg-slate-700",disabled:x,placeholder:"Panjul",...t})}),e.jsx(p,{className:"dark:text-red-500"})]})}),e.jsx(i,{control:n.control,name:"notes",render:({field:t,fieldState:r})=>e.jsxs(g,{children:[e.jsx(j,{className:r.error?"text-red-500":"dark:text-gray-300",children:"Notes"}),e.jsx(u,{children:e.jsx(je,{className:"w-full h-32 max-w-lg max-h-40 dark:bg-slate-700",disabled:x,placeholder:".....",...t})}),e.jsx(p,{className:"dark:text-red-500"})]})}),e.jsx(i,{control:n.control,name:"order_date",render:({field:t,fieldState:r})=>e.jsxs(g,{children:[e.jsx(j,{className:r.error?"text-red-500":"dark:text-gray-300",children:"Order Date"}),e.jsx(u,{children:e.jsxs(ae,{children:[e.jsx(oe,{asChild:!0,children:e.jsxs(y,{variant:"outline",className:fe("w-full justify-start gap-3 p-5 text-left font-normal dark:bg-slate-600 dark:hover:bg-slate-600",!t.value&&"text-muted-foreground"),children:[e.jsx(ne,{}),t.value?ve(t.value,"PPP"):e.jsx("span",{children:"Pick a date"})]})}),e.jsx(de,{className:"w-auto p-0",children:e.jsx(le,{mode:"single",selected:t.value,onSelect:t.onChange,initialFocus:!0})})]})}),e.jsx(p,{className:"dark:text-red-500"})]})}),e.jsx("div",{className:"hidden",children:e.jsx(i,{control:n.control,name:"total_amount",render:({field:t,fieldState:r})=>e.jsxs(g,{children:[e.jsx(j,{className:r.error?"text-red-500":"dark:text-gray-300",children:"Total amount"}),e.jsx(u,{children:e.jsx(w,{className:"dark:bg-slate-700",type:"number",disabled:!0,...t})}),e.jsx(p,{className:"dark:text-red-500"})]})})}),e.jsx(i,{control:n.control,name:"payment_method_id",render:({field:t,fieldState:r})=>e.jsxs(g,{children:[e.jsxs(j,{className:r.error?"text-red-500":"dark:text-gray-300",children:["Payment method",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs(E,{disabled:x,onValueChange:s=>{t.onChange(s),Y(s)},value:t.value.toString(),defaultValue:t.value.toString(),children:[e.jsx(u,{className:"dark:bg-slate-700",children:e.jsx(M,{className:"w-full",children:e.jsx(B,{defaultValue:t.value.toString(),placeholder:"Select a payment method"})})}),e.jsx(J,{children:m.filter(s=>s.status).map(s=>e.jsxs(k,{value:s.id.toString(),children:[s.name,s.name=="Cash"?"":` - ${s.bank_name}`]},s.id.toString()))})]}),e.jsx(p,{className:"dark:text-red-500"})]})}),(()=>{switch(F){case"Cash":return e.jsx(i,{control:n.control,name:"changes",render:({field:t,fieldState:r})=>e.jsxs(g,{children:[e.jsx(j,{className:r.error?"text-red-500":"dark:text-gray-300",children:"Changes"}),e.jsx(u,{children:e.jsx(w,{className:"dark:bg-slate-700",type:"number",disabled:x,...t})}),e.jsx(p,{className:"dark:text-red-500"})]})});case"QRIS":return e.jsxs(e.Fragment,{children:[e.jsx(y,{onClick:()=>P(!0),type:"button",variant:"outline",className:"text-white bg-sky-500 hover:bg-sky-500 hover:text-white hover:opacity-85",children:"Show QR code"}),e.jsx(ke,{paymentMethodId:n.getValues("payment_method_id"),paymentMethods:m,isVisible:A,onClose:()=>P(!1)})]});case"Bank Transfer":return e.jsx(Se,{paymentMethodId:n.getValues("payment_method_id"),paymentMethods:m});default:return null}})(),e.jsx(i,{control:n.control,name:"status",render:({field:t,fieldState:r})=>e.jsxs(g,{children:[e.jsxs(j,{className:r.error?"text-red-500":"dark:text-gray-300",children:["Payment Status",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx(u,{children:e.jsxs(E,{disabled:x,onValueChange:t.onChange,value:t.value,defaultValue:"Completed",children:[e.jsx(u,{className:"dark:bg-slate-700",children:e.jsx(M,{className:"w-full",children:e.jsx(B,{defaultValue:t.value,placeholder:"Select a payment status"})})}),e.jsxs(J,{children:[e.jsx(k,{value:"Completed",children:"Completed"}),e.jsx(k,{value:"Pending",children:"Pending"}),e.jsx(k,{value:"Cancelled",children:"Cancelled"})]})]})}),e.jsx(p,{className:"dark:text-red-500"})]})}),e.jsxs("div",{className:"flex flex-col items-center justify-between w-full gap-4 mt-5 md:w-1/2 lg:flex-row",children:[e.jsx(y,{disabled:x,className:"w-full",type:"submit",onClick:()=>q(!1),children:W}),e.jsx(y,{disabled:x,className:`${a?"hidden":""} w-full bg-slate-300 text-slate-950 hover:bg-slate-200 dark:bg-slate-700 dark:text-slate-200`,type:"submit",onClick:()=>q(!0),children:"Create & Create another"})]})]})]})})})]})};export{et as OrderForm};
