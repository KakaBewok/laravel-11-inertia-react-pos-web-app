import{r as u,j as e,y as k}from"./app-BmY1Do-R.js";import{B as y}from"./button-CoCtyn1R.js";import{P as X,a as Y,C as Z,b as D,c as ee}from"./popover-DJPIfLZ8.js";import{o as se,s as b,g as re,f as _,h as te,u as oe,t as ae,F as de,a as x,b as h,c as g,d as n,e as j,T as ce}from"./index-DAbcSfye.js";import{H as ne}from"./heading-DRkXQex5.js";import{I as S}from"./input-DLUMN1d1.js";import{S as F,a as P,b as T,d as q,e as N}from"./select-CRP0rkui.js";import{O as le,S as me}from"./order-summary-5xT5Etqx.js";import{u as ue}from"./useGlobalContext-DEDc1K2H.js";import{c as xe}from"./utils-CcFn7B-c.js";import{B as he}from"./react-toastify.esm-DQOW_WDH.js";import ge from"./product-cards-DB9tWF3L.js";import{f as je}from"./format-BEMO4FpZ.js";import"./index-BG4KsFYa.js";import"./createLucideIcon-2Xt1I0At.js";import"./react-icons.esm-CDMxvkF1.js";import"./index-i5Cu2bn0.js";import"./index-CgiO58h2.js";import"./index-B_3iuKlB.js";import"./index-DU0AJar9.js";import"./index-xZEHp8pJ.js";import"./index-B2fOyC-2.js";import"./index-B7sdyYxr.js";import"./index-Cv1yPUws.js";import"./image-not-found-BCeE-Ta1.js";import"./clsx-B-dksMZM.js";const pe=se({customer_name:b().min(3,{message:"Name must contain at least 3 character(s)"}),order_date:re().refine(r=>{const p=new Date;p.setHours(0,0,0,0);const f=new Date(p);return f.setDate(p.getDate()+1),r<f},{message:"Order date cannot be tomorrow or in the future."}),total_amount:_.number().min(0,{message:"Total amount must be greater than or equal to 0"}),total_paid:_.number().min(0,{message:"Total paid must be greater than or equal to 0"}),changes:_.number().min(0,{message:"Changes must be greater than or equal to 0"}),status:b().min(3,{message:"Status must contain at least 3 character(s)"}),notes:b().optional(),payment_method_id:b().min(1,{message:"Payment method is required"}),products:te(b().min(2))}),Ge=({initialData:r,paymentMethods:p,products:f})=>{const{loading:l,setLoading:C}=ue(),[V,O]=u.useState(0),[E,A]=u.useState(!1),[c,i]=u.useState([]),[v,B]=u.useState(""),H=f.filter(s=>s.name.toLowerCase().includes(v.toLowerCase())),[J,w]=u.useState(!1),L=r?"Edit order":"Create order",M=r?"Edit an order":"Add a new order",Q=r?"Order updated.":"Order created.",G=r?"Save changes":"Create",a=oe({resolver:ae(pe),defaultValues:{customer_name:(r==null?void 0:r.customer_name)||"",order_date:(r==null?void 0:r.order_date)||new Date,total_amount:(r==null?void 0:r.total_amount)||0,total_paid:(r==null?void 0:r.total_paid)||0,changes:(r==null?void 0:r.changes)||0,status:(r==null?void 0:r.status)||"",notes:(r==null?void 0:r.notes)||"",payment_method_id:(r==null?void 0:r.payment_method_id)||"",products:r==null?void 0:r.products}}),R=s=>{C(!0);const t=()=>{a.reset(),localStorage.removeItem("selectedItems"),localStorage.removeItem("formData")},o=()=>{t(),J?k.visit(route("admin.order.create")):k.visit(route("admin.order.index")),setTimeout(()=>{he.success(Q,{position:"top-center"})},1e3)},d=W=>{console.log("An error occurred: ",W)},m=()=>C(!1);r?k.post(route("admin.order.update",r==null?void 0:r.id),{...s,_method:"PATCH"},{onSuccess:o,onError:d,onFinish:m}):k.post(route("admin.order.store"),s,{onSuccess:o,onError:d,onFinish:m})},$=s=>{const t=p.find(o=>o.id.toString()===s);A((t==null?void 0:t.is_cash)||!1),a.setValue("payment_method_id",s)},z=(s,t)=>{const o=f.find(d=>d.id==s.id);o&&i(c.map(d=>{if(d.id===s.id){let m=d.stock_quantity+t;return m=Math.min(m,o.stock_quantity),m=Math.max(m,0),{...d,stock_quantity:m}}return d}).filter(d=>d.stock_quantity>0))},K=s=>{const t=c.find(o=>o.id===s.id);i(t?c.map(o=>o.id===s.id?{...o,stock_quantity:Math.min(o.stock_quantity+1,s.stock_quantity)}:o):[...c,{...s,stock_quantity:1}])},U=s=>{i(c.filter(t=>t.id!==s.id))};u.useEffect(()=>{const s=c.reduce((o,d)=>o+d.price*d.stock_quantity,0),t=c.reduce((o,d)=>o+d.stock_quantity,0);a.setValue("total_amount",s),O(t)},[c,a.setValue]);const I=a.watch();return u.useEffect(()=>{const s=localStorage.getItem("selectedItems"),t=localStorage.getItem("formData");s&&i(JSON.parse(s)),t&&a.reset(JSON.parse(t))},[]),u.useEffect(()=>{localStorage.setItem("selectedItems",JSON.stringify(c)),localStorage.setItem("formData",JSON.stringify(I))},[c,I]),e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(ne,{title:L,description:M}),e.jsx(y,{variant:"outline",onClick:()=>window.history.back(),className:"dark:bg-slate-200 dark:text-slate-900",children:"Back"})]}),e.jsx(ge,{searchTerm:v,setSearchTerm:B,filteredProducts:H,addItem:K}),e.jsx(de,{...a,children:e.jsx("form",{onSubmit:a.handleSubmit(R),className:"w-full p-8 space-y-8 rounded-md bg-slate-50 dark:bg-gradient-to-tr md:dark:bg-gradient-to-br dark:from-slate-950 dark:via-slate-900 dark:to-slate-800",children:e.jsxs("div",{className:"grid w-full grid-cols-1 gap-4 md:gap-20 md:grid-cols-2",children:[e.jsx(le,{selectedItems:c,adjustQuantity:z,removeItem:U,totalItems:V,form:a}),e.jsxs("div",{className:"flex flex-col w-full gap-4",children:[e.jsxs("div",{className:"mb-4",children:[e.jsx("h1",{className:"mb-2 text-lg font-bold",children:"Form Checkout"}),e.jsx(me,{className:"dark:bg-slate-700 bg-slate-300"})]}),e.jsx(x,{control:a.control,name:"customer_name",render:({field:s,fieldState:t})=>e.jsxs(h,{children:[e.jsx(g,{className:t.error?"text-red-500":"dark:text-gray-300",children:"Customer name"}),e.jsx(n,{children:e.jsx(S,{className:"dark:bg-slate-700",disabled:l,placeholder:"Panjul",...s})}),e.jsx(j,{className:"dark:text-red-500"})]})}),e.jsx(x,{control:a.control,name:"notes",render:({field:s,fieldState:t})=>e.jsxs(h,{children:[e.jsx(g,{className:t.error?"text-red-500":"dark:text-gray-300",children:"Notes"}),e.jsx(n,{children:e.jsx(ce,{className:"w-full h-32 max-w-lg max-h-40 dark:bg-slate-700",disabled:l,placeholder:".....",...s})}),e.jsx(j,{className:"dark:text-red-500"})]})}),e.jsx(x,{control:a.control,name:"order_date",render:({field:s,fieldState:t})=>e.jsxs(h,{children:[e.jsx(g,{className:t.error?"text-red-500":"dark:text-gray-300",children:"Order date"}),e.jsx(n,{children:e.jsxs(X,{children:[e.jsx(Y,{asChild:!0,children:e.jsxs(y,{variant:"outline",className:xe("w-full justify-start gap-3 p-5 text-left font-normal dark:bg-slate-600 dark:hover:bg-slate-600",!s.value&&"text-muted-foreground"),children:[e.jsx(Z,{}),s.value?je(s.value,"PPP"):e.jsx("span",{children:"Pick a date"})]})}),e.jsx(D,{className:"w-auto p-0",children:e.jsx(ee,{mode:"single",selected:s.value,onSelect:s.onChange,initialFocus:!0})})]})}),e.jsx(j,{className:"dark:text-red-500"})]})}),e.jsx(x,{control:a.control,name:"payment_method_id",render:({field:s,fieldState:t})=>e.jsxs(h,{children:[e.jsx(g,{className:t.error?"text-red-500":"dark:text-gray-300",children:"Payment method"}),e.jsxs(F,{disabled:l,onValueChange:o=>{s.onChange(o),$(o)},value:s.value.toString(),defaultValue:s.value.toString(),children:[e.jsx(n,{className:"dark:bg-slate-700",children:e.jsx(P,{className:"w-full",children:e.jsx(T,{defaultValue:s.value.toString(),placeholder:"Select a payment method"})})}),e.jsx(q,{children:p.filter(o=>o.status).map(o=>e.jsx(N,{value:o.id.toString(),children:o.name},o.id.toString()))})]}),e.jsx(j,{className:"dark:text-red-500"})]})}),e.jsx(x,{control:a.control,name:"total_amount",render:({field:s,fieldState:t})=>e.jsxs(h,{children:[e.jsx(g,{className:t.error?"text-red-500":"dark:text-gray-300",children:"Total amount"}),e.jsx(n,{children:e.jsx(S,{className:"dark:bg-slate-700",type:"number",disabled:!0,...s})}),e.jsx(j,{className:"dark:text-red-500"})]})}),e.jsx(x,{control:a.control,name:"total_paid",render:({field:s,fieldState:t})=>e.jsxs(h,{children:[e.jsx(g,{className:t.error?"text-red-500":"dark:text-gray-300",children:"Total paid"}),e.jsx(n,{children:e.jsx(S,{className:"dark:bg-slate-700",type:"number",disabled:l,...s})}),e.jsx(j,{className:"dark:text-red-500"})]})}),E&&e.jsx(x,{control:a.control,name:"changes",render:({field:s,fieldState:t})=>e.jsxs(h,{children:[e.jsx(g,{className:t.error?"text-red-500":"dark:text-gray-300",children:"Changes"}),e.jsx(n,{children:e.jsx(S,{className:"dark:bg-slate-700",type:"number",disabled:l,...s})}),e.jsx(j,{className:"dark:text-red-500"})]})}),e.jsx(x,{control:a.control,name:"status",render:({field:s,fieldState:t})=>e.jsxs(h,{children:[e.jsx(g,{className:t.error?"text-red-500":"dark:text-gray-300",children:"Status"}),e.jsx(n,{children:e.jsxs(F,{disabled:l,onValueChange:s.onChange,value:s.value,defaultValue:"Completed",children:[e.jsx(n,{className:"dark:bg-slate-700",children:e.jsx(P,{className:"w-full",children:e.jsx(T,{defaultValue:s.value,placeholder:"Select a status"})})}),e.jsxs(q,{children:[e.jsx(N,{value:"Completed",children:"Completed"}),e.jsx(N,{value:"Pending",children:"Pending"}),e.jsx(N,{value:"Cancelled",children:"Cancelled"})]})]})}),e.jsx(j,{className:"dark:text-red-500"})]})}),e.jsxs("div",{className:"flex flex-col items-center justify-between w-full gap-4 mt-10 lg:flex-row",children:[e.jsx(y,{disabled:l,className:"w-full",type:"submit",onClick:()=>w(!1),children:G}),e.jsx(y,{disabled:l,className:"w-full bg-slate-300 text-slate-950 hover:bg-slate-200",type:"submit",onClick:()=>w(!0),children:"Create & Create another"})]})]})]})})})]})};export{Ge as OrderForm};
