import{r as x,j as e,y as k}from"./app-CFpK7jNL.js";import{B as N}from"./button-DI8lM0hK.js";import{P as K,a as U,C as W,b as X,c as Y}from"./popover-DfPVb7F9.js";import{o as Z,s as b,g as D,f as _,h as ee,u as se,t as re,F as te,a as h,b as g,c as j,d as n,e as p}from"./index-Czb7JRCe.js";import{H as oe}from"./heading-BkKrbAuW.js";import{I as v}from"./input-Cnu_APYr.js";import{S as P,a as T,b as q,d as O,e as y}from"./select-Db3Qls2_.js";import{O as ae,S as de}from"./order-summary-sBL8OfTl.js";import{T as ce}from"./textarea-DRwS2fFv.js";import{u as le}from"./useGlobalContext-DpoTVwfz.js";import{c as ne}from"./utils-CcFn7B-c.js";import{B as me}from"./react-toastify.esm-DWkCdtop.js";import ue from"./product-cards-f4yVwCbX.js";import{f as xe}from"./format-BEMO4FpZ.js";import"./index-DFBz5MRV.js";import"./createLucideIcon-XyDN5AVm.js";import"./react-icons.esm-DvMEuux4.js";import"./index-CECetD3n.js";import"./index-pfC0p5Pa.js";import"./index-BjLbwCKc.js";import"./index-Ch4xAwkz.js";import"./index-CUQ4fU9_.js";import"./image-not-found-BCeE-Ta1.js";import"./constants-BUrVtmhx.js";import"./clsx-B-dksMZM.js";const he=Z({customer_name:b().min(3,{message:"Name must contain at least 3 character(s)"}),order_date:D().refine(r=>{const f=new Date;f.setHours(0,0,0,0);const m=new Date(f);return m.setDate(f.getDate()+1),r<m},{message:"Order date cannot be tomorrow or in the future."}),total_amount:_.number().min(0,{message:"Total amount must be greater than or equal to 0"}),total_paid:_.number().min(0,{message:"Total paid must be greater than or equal to 0"}),changes:_.number().min(0,{message:"Changes must be greater than or equal to 0"}),status:b().min(3,{message:"Status must contain at least 3 character(s)"}),notes:b().optional(),payment_method_id:b().min(1,{message:"Payment method is required"}),products:ee(b().min(2))}),Je=({initialData:r,paymentMethods:f,products:m})=>{const{loading:u,setLoading:C}=le(),[V,E]=x.useState(0),[c,i]=x.useState([]),[w,A]=x.useState(""),B=m.filter(s=>s.name.toLowerCase().includes(w.toLowerCase())),[H,I]=x.useState(!1),J=r?"Edit order":"Create order",L=r?"Edit an order":"Add a new order",M=r?"Order updated.":"Order created.",Q=r?"Save changes":"Create",d=se({resolver:re(he),defaultValues:{customer_name:(r==null?void 0:r.customer_name)||"",order_date:(r==null?void 0:r.order_date)||new Date,total_amount:(r==null?void 0:r.total_amount)||0,total_paid:(r==null?void 0:r.total_paid)||0,changes:(r==null?void 0:r.changes)||0,status:(r==null?void 0:r.status)||"",notes:(r==null?void 0:r.notes)||"",payment_method_id:(r==null?void 0:r.payment_method_id)||"",products:r==null?void 0:r.products}}),G=s=>{C(!0);const t=()=>{d.reset(),localStorage.removeItem("selectedItems"),localStorage.removeItem("formData")},o=()=>{t(),H?k.visit(route("admin.order.create")):k.visit(route("admin.order.index")),setTimeout(()=>{me.success(M,{position:"top-center"})},1e3)},a=S=>{console.log("An error occurred: ",S)},l=()=>C(!1);r?k.post(route("admin.order.update",r==null?void 0:r.id),{...s,_method:"PATCH"},{onSuccess:o,onError:a,onFinish:l}):k.post(route("admin.order.store"),s,{onSuccess:o,onError:a,onFinish:l})},R=(s,t)=>{const o=m.find(a=>a.id==s.id);o&&i(c.map(a=>{if(a.id===s.id){let l=a.stock_quantity+t;return l=Math.min(l,o.stock_quantity),l=Math.max(l,0),{...a,stock_quantity:l}}return a}).filter(a=>a.stock_quantity>0))},$=s=>{const t=c.find(o=>o.id===s.id);i(t?c.map(o=>o.id===s.id?{...o,stock_quantity:Math.min(o.stock_quantity+1,s.stock_quantity)}:o):[...c,{...s,stock_quantity:1}])},z=s=>{i(c.filter(t=>t.id!==s.id))};x.useEffect(()=>{const s=c.reduce((o,a)=>o+a.price*a.stock_quantity,0),t=c.reduce((o,a)=>o+a.stock_quantity,0);d.setValue("total_amount",s),E(t)},[c,d.setValue]);const F=d.watch();return x.useEffect(()=>{const s=localStorage.getItem("selectedItems"),t=localStorage.getItem("formData");if(s){const a=JSON.parse(s).filter(l=>m.some(S=>S.id===l.id));i(a)}t&&d.reset(JSON.parse(t))},[]),x.useEffect(()=>{localStorage.setItem("selectedItems",JSON.stringify(c)),localStorage.setItem("formData",JSON.stringify(F))},[c,F]),e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(oe,{title:J,description:L}),e.jsx(N,{variant:"outline",onClick:()=>window.history.back(),className:"dark:bg-slate-200 dark:text-slate-900",children:"Back"})]}),e.jsx(ue,{searchTerm:w,setSearchTerm:A,filteredProducts:B,addItem:$}),e.jsx(te,{...d,children:e.jsx("form",{onSubmit:d.handleSubmit(G),className:"w-full p-8 space-y-8 rounded-md bg-slate-50 dark:bg-gradient-to-tr md:dark:bg-gradient-to-br dark:from-slate-950 dark:via-slate-900 dark:to-slate-800",children:e.jsxs("div",{className:"grid w-full grid-cols-1 gap-4 md:gap-20 md:grid-cols-2",children:[e.jsx(ae,{products:m,selectedItems:c,adjustQuantity:R,removeItem:z,totalItems:V,form:d}),e.jsxs("div",{className:"flex flex-col w-full gap-4",children:[e.jsxs("div",{className:"mb-4",children:[e.jsx("h1",{className:"mb-2 text-lg font-bold",children:"Form Checkout"}),e.jsx(de,{className:"dark:bg-slate-700 bg-slate-300"})]}),e.jsx(h,{control:d.control,name:"customer_name",render:({field:s,fieldState:t})=>e.jsxs(g,{children:[e.jsxs(j,{className:t.error?"text-red-500":"dark:text-gray-300",children:["Customer name",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx(n,{children:e.jsx(v,{className:"dark:bg-slate-700",disabled:u,placeholder:"Panjul",...s})}),e.jsx(p,{className:"dark:text-red-500"})]})}),e.jsx(h,{control:d.control,name:"notes",render:({field:s,fieldState:t})=>e.jsxs(g,{children:[e.jsx(j,{className:t.error?"text-red-500":"dark:text-gray-300",children:"Notes"}),e.jsx(n,{children:e.jsx(ce,{className:"w-full h-32 max-w-lg max-h-40 dark:bg-slate-700",disabled:u,placeholder:".....",...s})}),e.jsx(p,{className:"dark:text-red-500"})]})}),e.jsx(h,{control:d.control,name:"order_date",render:({field:s,fieldState:t})=>e.jsxs(g,{children:[e.jsx(j,{className:t.error?"text-red-500":"dark:text-gray-300",children:"Order date"}),e.jsx(n,{children:e.jsxs(K,{children:[e.jsx(U,{asChild:!0,children:e.jsxs(N,{variant:"outline",className:ne("w-full justify-start gap-3 p-5 text-left font-normal dark:bg-slate-600 dark:hover:bg-slate-600",!s.value&&"text-muted-foreground"),children:[e.jsx(W,{}),s.value?xe(s.value,"PPP"):e.jsx("span",{children:"Pick a date"})]})}),e.jsx(X,{className:"w-auto p-0",children:e.jsx(Y,{mode:"single",selected:s.value,onSelect:s.onChange,initialFocus:!0})})]})}),e.jsx(p,{className:"dark:text-red-500"})]})}),e.jsx(h,{control:d.control,name:"payment_method_id",render:({field:s,fieldState:t})=>e.jsxs(g,{children:[e.jsxs(j,{className:t.error?"text-red-500":"dark:text-gray-300",children:["Payment method",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs(P,{disabled:u,onValueChange:o=>{s.onChange(o)},value:s.value.toString(),defaultValue:s.value.toString(),children:[e.jsx(n,{className:"dark:bg-slate-700",children:e.jsx(T,{className:"w-full",children:e.jsx(q,{defaultValue:s.value.toString(),placeholder:"Select a payment method"})})}),e.jsx(O,{children:f.filter(o=>o.status).map(o=>e.jsx(y,{value:o.id.toString(),children:o.name},o.id.toString()))})]}),e.jsx(p,{className:"dark:text-red-500"})]})}),e.jsx(h,{control:d.control,name:"total_amount",render:({field:s,fieldState:t})=>e.jsxs(g,{children:[e.jsx(j,{className:t.error?"text-red-500":"dark:text-gray-300",children:"Total amount"}),e.jsx(n,{children:e.jsx(v,{className:"dark:bg-slate-700",type:"number",disabled:!0,...s})}),e.jsx(p,{className:"dark:text-red-500"})]})}),e.jsx(h,{control:d.control,name:"total_paid",render:({field:s,fieldState:t})=>e.jsxs(g,{children:[e.jsxs(j,{className:t.error?"text-red-500":"dark:text-gray-300",children:["Total paid",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx(n,{children:e.jsx(v,{className:"dark:bg-slate-700",type:"number",disabled:u,...s})}),e.jsx(p,{className:"dark:text-red-500"})]})}),e.jsx(h,{control:d.control,name:"status",render:({field:s,fieldState:t})=>e.jsxs(g,{children:[e.jsxs(j,{className:t.error?"text-red-500":"dark:text-gray-300",children:["Status",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx(n,{children:e.jsxs(P,{disabled:u,onValueChange:s.onChange,value:s.value,defaultValue:"Completed",children:[e.jsx(n,{className:"dark:bg-slate-700",children:e.jsx(T,{className:"w-full",children:e.jsx(q,{defaultValue:s.value,placeholder:"Select a status"})})}),e.jsxs(O,{children:[e.jsx(y,{value:"Completed",children:"Completed"}),e.jsx(y,{value:"Pending",children:"Pending"}),e.jsx(y,{value:"Cancelled",children:"Cancelled"})]})]})}),e.jsx(p,{className:"dark:text-red-500"})]})}),e.jsxs("div",{className:"flex flex-col items-center justify-between w-full gap-4 mt-10 lg:flex-row",children:[e.jsx(N,{disabled:u,className:"w-full",type:"submit",onClick:()=>I(!1),children:Q}),e.jsx(N,{disabled:u,className:"w-full bg-slate-300 text-slate-950 hover:bg-slate-200",type:"submit",onClick:()=>I(!0),children:"Create & Create another"})]})]})]})})})]})};export{Je as OrderForm};
