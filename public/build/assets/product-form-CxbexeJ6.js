import{r as f,j as e,y as b}from"./app-CFpK7jNL.js";import{B as v}from"./button-DI8lM0hK.js";import{o as M,s as g,f as S,h as G,j as K,k as H,u as z,t as O,F as X,a as m,b as u,c as x,d,e as h,l as Y}from"./index-Czb7JRCe.js";import{H as Z}from"./heading-BkKrbAuW.js";import{I as k}from"./input-Cnu_APYr.js";import{S as E,a as P,b as T,d as A,e as y}from"./select-Db3Qls2_.js";import{T as J}from"./textarea-DRwS2fFv.js";import{u as Q}from"./useGlobalContext-DpoTVwfz.js";import{B as W}from"./react-toastify.esm-DWkCdtop.js";import{A as D,M as w,B as ee}from"./constants-BUrVtmhx.js";import{u as se}from"./file-utils-CdlLiblU.js";import"./index-DFBz5MRV.js";import"./utils-CcFn7B-c.js";import"./clsx-B-dksMZM.js";import"./index-pfC0p5Pa.js";import"./react-icons.esm-DvMEuux4.js";import"./index-CECetD3n.js";import"./index-Ch4xAwkz.js";import"./index-BjLbwCKc.js";import"./index-CUQ4fU9_.js";const re=M({name:g().min(3,{message:"Name must contain at least 3 character(s)"}),price:S.number().min(0,{message:"Price must be greater than or equal to 0"}),category_id:g().min(1,{message:"Category is required"}),description:g().optional(),unit:g().min(1,{message:"Unit is required"}),stock_quantity:S.number().min(0,{message:"Stock must be greater than or equal to 0"}),photos:G(K([H(File).refine(s=>D.includes(s.type),{message:" must be jpg, jpeg, png or webp formats"}).refine(s=>s.size<=w*1024,{message:` is more than ${w}KB`}),g()])).optional()}),ve=({initialData:s,categories:_})=>{const[i,j]=f.useState([]),n=f.useRef(null),{loading:l,setLoading:F}=Q(),[I,C]=f.useState(!1),V=s?"Edit product":"Create product",U=s?"Edit a product":"Add a new product",q=s?"Product updated.":"Product created.",B=s?"Save changes":"Create",c=z({resolver:O(re),defaultValues:{name:(s==null?void 0:s.name)||"",price:(s==null?void 0:s.price)||0,category_id:(s==null?void 0:s.category_id)||"",description:(s==null?void 0:s.description)||"",unit:(s==null?void 0:s.unit)||"",stock_quantity:(s==null?void 0:s.stock_quantity)||0,photos:s==null?void 0:s.photos}});f.useEffect(()=>{(async()=>{if(s&&s.photos.length>0){const o=await Promise.all(s.photos.map((a,p)=>{const N=`${ee}/storage/${a}`;return se(N,`product-image-${p}.jpg`,"image/jpeg")}));j(o);const t=new DataTransfer;o.forEach(a=>t.items.add(a)),n.current&&(n.current.files=t.files),c.setValue("photos",o)}})()},[s,c]);const $=r=>{if(r.target.files){const o=Array.from(r.target.files);j([...i,...o]),c.setValue("photos",[...i,...o])}},L=r=>{const o=i.filter((a,p)=>p!==r);j(o);const t=new DataTransfer;o.forEach(a=>t.items.add(a)),n.current&&(n.current.files=t.files),c.setValue("photos",o)},R=r=>{F(!0);const o=()=>{c.reset(),j([]),n.current&&(n.current.value="")},t=()=>{o(),I?b.visit(route("admin.product.create")):b.visit(route("admin.product.index")),setTimeout(()=>{W.success(q,{position:"top-center"})},1e3)},a=N=>{console.log("An error occurred: ",N)},p=()=>F(!1);s?b.post(route("admin.product.update",s==null?void 0:s.id),{...r,_method:"PATCH"},{onSuccess:t,onError:a,onFinish:p}):b.post(route("admin.product.store"),r,{onSuccess:t,onError:a,onFinish:p})};return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(Z,{title:V,description:U}),e.jsx(v,{variant:"outline",onClick:()=>window.history.back(),className:"dark:bg-slate-200 dark:text-slate-900",children:"Back"})]}),e.jsx(X,{...c,children:e.jsxs("form",{onSubmit:c.handleSubmit(R),className:"w-full p-8 space-y-8 rounded-md bg-slate-50 dark:bg-gradient-to-tr md:dark:bg-gradient-to-br dark:from-slate-950 dark:via-slate-900 dark:to-slate-800",children:[e.jsxs("div",{className:"grid grid-cols-1 gap-4 md:gap-8 md:grid-cols-2",children:[e.jsx(m,{control:c.control,name:"name",render:({field:r,fieldState:o})=>e.jsxs(u,{children:[e.jsxs(x,{className:o.error?"text-red-500":"dark:text-gray-300",children:["Name"," ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx(d,{children:e.jsx(k,{className:"dark:bg-slate-700",disabled:l,placeholder:"Arabica coffe beans",...r})}),e.jsx(h,{className:"dark:text-red-500"})]})}),e.jsx(m,{control:c.control,name:"price",render:({field:r,fieldState:o})=>e.jsxs(u,{children:[e.jsxs(x,{className:o.error?"text-red-500":"dark:text-gray-300",children:["Price",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx(d,{children:e.jsx(k,{className:"dark:bg-slate-700",type:"number",disabled:l,...r})}),e.jsx(h,{className:"dark:text-red-500"})]})}),e.jsx(m,{control:c.control,name:"category_id",render:({field:r,fieldState:o})=>e.jsxs(u,{children:[e.jsxs(x,{className:o.error?"text-red-500":"dark:text-gray-300",children:["Category"," ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs(E,{disabled:l,onValueChange:r.onChange,value:r.value.toString(),defaultValue:r.value.toString(),children:[e.jsx(d,{className:"dark:bg-slate-700",children:e.jsx(P,{className:"w-full",children:e.jsx(T,{defaultValue:r.value.toString(),placeholder:"Select a category"})})}),e.jsx(A,{children:_.map(t=>e.jsx(y,{value:t.id.toString(),children:t.name},t.id.toString()))})]}),e.jsx(h,{className:"dark:text-red-500"})]})}),e.jsx(m,{control:c.control,name:"unit",render:({field:r,fieldState:o})=>e.jsxs(u,{children:[e.jsxs(x,{className:o.error?"text-red-500":"dark:text-gray-300",children:["Unit"," ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx(d,{children:e.jsxs(E,{disabled:l,onValueChange:r.onChange,value:r.value,defaultValue:r.value,children:[e.jsx(d,{className:"dark:bg-slate-700",children:e.jsx(P,{className:"w-full",children:e.jsx(T,{defaultValue:r.value,placeholder:"Select a unit"})})}),e.jsxs(A,{children:[e.jsx(y,{value:"Gram",children:"Gram"}),e.jsx(y,{value:"Kilogram",children:"Kilogram"}),e.jsx(y,{value:"Pcs",children:"Pcs"})]})]})}),e.jsx(h,{className:"dark:text-red-500"})]})}),e.jsx(m,{control:c.control,name:"stock_quantity",render:({field:r,fieldState:o})=>e.jsxs(u,{children:[e.jsxs(x,{className:o.error?"text-red-500":"dark:text-gray-300",children:["Stock",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx(d,{children:e.jsx(k,{className:"dark:bg-slate-700",type:"number",disabled:l,...r})}),e.jsx(h,{className:"dark:text-red-500"})]})}),e.jsx(m,{control:c.control,name:"description",render:({field:r,fieldState:o})=>e.jsxs(u,{children:[e.jsx(x,{className:o.error?"text-red-500":"dark:text-gray-300",children:"Description"}),e.jsx(d,{children:e.jsx(J,{className:"w-full h-32 max-w-lg max-h-40 dark:bg-slate-700",disabled:l,placeholder:"Description of Arabica coffe beans like size, color etc.",...r})}),e.jsx(h,{className:"dark:text-red-500"})]})})]}),e.jsxs("div",{className:"flex flex-col gap-8",children:[e.jsx(m,{control:c.control,name:"photos",render:({fieldState:r})=>e.jsxs(u,{children:[e.jsx(x,{className:r.error?"text-red-500":"dark:text-gray-300",children:"Product Images"}),e.jsxs(Y,{children:["Upload each image up to ",w,"KB (jpg, jpeg, png, webp only)."]}),e.jsx(d,{children:e.jsx(k,{className:"w-full md:w-[48%] dark:bg-slate-700",ref:n,type:"file",multiple:!0,accept:"image/jpeg, image/png, image/jpg, image/webp",onChange:$})}),r.error&&e.jsx("ul",{className:"flex flex-col gap-6 py-2 text-sm text-red-500 md:gap-3",children:(Array.isArray(r.error)?r.error:[r.error]).map((o,t)=>e.jsx("li",{children:`- Image number ${t+1} ${(o==null?void 0:o.message)||"Unknown error"}`},t))})]})}),e.jsx("div",{className:"flex flex-wrap items-center justify-center gap-8 md:justify-start",children:i.map((r,o)=>e.jsxs("div",{className:"relative overflow-hidden border rounded-md shadow-md dark:border-gray-200 border-slate-300 w-52 h-52",children:[e.jsx("img",{src:URL.createObjectURL(r),alt:`Uploaded ${o}`,className:"object-cover w-full h-full"},o),e.jsx("button",{className:"absolute flex items-center justify-center w-6 h-6 text-white bg-red-500 rounded-full top-2 right-2",type:"button",onClick:()=>L(o),children:e.jsx("span",{className:"text-xs leading-none",children:"âœ•"})})]},o))})]}),e.jsxs("div",{className:"flex flex-col items-center justify-between w-full gap-4 mt-10 md:w-1/2 lg:flex-row",children:[e.jsx(v,{disabled:l,className:"w-full",type:"submit",onClick:()=>C(!1),children:B}),e.jsx(v,{disabled:l,className:`${s?"hidden":""} w-full bg-slate-300 text-slate-950 hover:bg-slate-200 dark:bg-slate-700 dark:text-slate-200`,type:"submit",onClick:()=>C(!0),children:"Create & Create another"})]})]})})]})};export{ve as ProductForm};
