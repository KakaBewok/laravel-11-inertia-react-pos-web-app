import{r as c,j as e,y as S}from"./app-BDFo6oUw.js";import{B as b}from"./button-DArU0F6p.js";import{P as ae,a as oe,C as ne,b as de,c as le}from"./popover-B10tGWF6.js";import{o as ce,s as N,g as me,f as O,u as ue,t as he,F as xe,a as g,b as p,c as j,d as h,e as f}from"./index-DdakI-U2.js";import{H as ie}from"./heading-CbGLtiTL.js";import{I as w}from"./input-Ci5xMt7U.js";import{S as E,a as M,b as B,d as J,e as k}from"./select-BnFr0tFP.js";import{S as ge}from"./separator-DJ0gT-sQ.js";import{T as pe}from"./textarea-CeYXHsLJ.js";import{u as je}from"./useGlobalContext-CJNLfktq.js";import{c as fe}from"./utils-CcFn7B-c.js";import{B as ye}from"./react-toastify.esm-6DYMdDcn.js";import{BankTransferCard as be}from"./bank-transfer-card-BHU35xIm.js";import Se from"./order-summary-CopRD85f.js";import Ne from"./product-cards-DvLiKVUE.js";import{QrModal as ke}from"./qr-modal-D24Vti_b.js";import{f as ve}from"./format-BEMO4FpZ.js";import"./index-C-Wu41O2.js";import"./createLucideIcon-wUse0bSb.js";import"./react-icons.esm-Bon-99m0.js";import"./index-CAqmWMrS.js";import"./index-DSKujPjE.js";import"./index-BEguvLlE.js";import"./index-a83yYvjM.js";import"./index-CXarvApX.js";import"./clsx-B-dksMZM.js";import"./constants-BUrVtmhx.js";import"./image-not-found-BCeE-Ta1.js";const Ce=ce({customer_name:N().min(3,{message:"Name must contain at least 3 character(s)"}),order_date:me().refine(s=>{const u=new Date;u.setHours(0,0,0,0);const x=new Date(u);return x.setDate(u.getDate()+1),s<x},{message:"Order date cannot be tomorrow or in the future."}),total_amount:O.number().min(0,{message:"Total amount must be greater than or equal to 0"}),changes:O.number().min(0,{message:"Changes must be greater than or equal to 0"}),status:N().min(3,{message:"Status must contain at least 3 character(s)"}),notes:N().optional(),payment_method_id:N().min(1,{message:"Payment method is required"})}),et=({initialData:s,paymentMethods:u,products:x})=>{const{loading:i,setLoading:I}=je(),[F,v]=c.useState(null),[A,P]=c.useState(!1),[Q,H]=c.useState(0),[V,L]=c.useState(0),[d,y]=c.useState(s&&s.selectedItems?s.selectedItems:[]),[q,$]=c.useState(""),R=x.filter(t=>t.name.toLowerCase().includes(q.toLowerCase())&&t.stock_quantity>0),[z,T]=c.useState(!1),G=s?"Edit order":"Create order",K=s?"Edit an order":"Add a new order",U=s?"Order updated.":"Order created.",W=s?"Save changes":"Create",C={customer_name:"",order_date:new Date,total_amount:V,changes:0,status:"",notes:"",payment_method_id:""},n=ue({resolver:he(Ce),defaultValues:{customer_name:(s==null?void 0:s.customer_name)||"",order_date:(s==null?void 0:s.order_date)||new Date,total_amount:(s==null?void 0:s.total_amount)||V,changes:(s==null?void 0:s.changes)||0,status:(s==null?void 0:s.status)||"",notes:(s==null?void 0:s.notes)||"",payment_method_id:(s==null?void 0:s.payment_method_id)||""}}),_=n.watch(),X=t=>{I(!0);const a=()=>{localStorage.removeItem("selectedItems"),localStorage.removeItem("formData"),localStorage.removeItem("paymentMethodName"),n.reset()},r=()=>{z?S.visit(route("admin.order.create")):S.visit(route("admin.order.index")),setTimeout(()=>{ye.success(U,{position:"top-center"}),a()},1e3)},o=m=>{console.log("An error occurred: ",m)},l=()=>I(!1);s?S.post(route("admin.order.update",s==null?void 0:s.id),{...t,items:[...d.map(m=>({product_id:m.id,quantity:m.quantity}))],_method:"PATCH"},{onSuccess:r,onError:o,onFinish:l}):S.post(route("admin.order.store"),{...t,items:[...d.map(m=>({product_id:m.id,quantity:m.quantity}))]},{onSuccess:r,onError:o,onFinish:l})},Y=t=>{const a=u.find(r=>r.id.toString()===t);v((a==null?void 0:a.name)??null)},Z=(t,a)=>{const r=x.find(o=>o.id==t.id);r&&y(d.map(o=>{if(o.id===t.id){let l=o.quantity+a;return l=Math.min(l,r.stock_quantity),l=Math.max(l,0),{...o,quantity:l}}return o}).filter(o=>o.quantity>0))},D=t=>{const a=d.find(r=>r.id===t.id);y(a?d.map(r=>r.id===t.id?{...r,quantity:Math.min(r.quantity+1,t.stock_quantity)}:r):[...d,{id:t.id,product_name:t.name,price:t.price,unit:t.unit,quantity:1,total_price:t.price,photos:t.photos}])},ee=t=>{y(d.filter(a=>a.id!==t.id))};c.useEffect(()=>{const t=d.reduce((r,o)=>r+o.price*o.quantity,0),a=d.reduce((r,o)=>r+o.quantity,0);n.setValue("total_amount",t),L(t),H(a)},[d,n.setValue]),c.useEffect(()=>{if(!s){const t=localStorage.getItem("selectedItems"),a=localStorage.getItem("formData"),r=localStorage.getItem("paymentMethodName");if(t){const l=JSON.parse(t).filter(m=>x.some(re=>re.id===m.id));y(l)}if(a){const o=JSON.parse(a);o.order_date&&(o.order_date=new Date(o.order_date)),n.reset(o)}r&&v(JSON.parse(r)??null)}},[]),c.useEffect(()=>{s||(localStorage.setItem("selectedItems",JSON.stringify(d)),localStorage.setItem("formData",JSON.stringify(_)),localStorage.setItem("paymentMethodName",JSON.stringify(F)))},[d,_]);const te=Object.keys(C).every(t=>{const a=C[t],r=_[t];return a instanceof Date&&r instanceof Date?a.toDateString()===r.toDateString():r===a}),se=()=>{n.reset(C),v("")};return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(ie,{title:G,description:K}),e.jsx(b,{variant:"outline",onClick:()=>window.history.back(),className:"dark:bg-slate-200 dark:text-slate-900",children:"Back"})]}),e.jsx(Ne,{searchTerm:q,setSearchTerm:$,filteredProducts:R,addItem:D}),e.jsx(xe,{...n,children:e.jsx("form",{onSubmit:n.handleSubmit(X),className:"w-full p-8 space-y-8 rounded-md bg-slate-50 dark:bg-gradient-to-tr md:dark:bg-gradient-to-br dark:from-slate-950 dark:via-slate-900 dark:to-slate-800",children:e.jsxs("div",{className:"grid w-full grid-cols-1 gap-4 md:gap-20 md:grid-cols-2",children:[e.jsx(Se,{products:x,selectedItems:d,setSelectedItems:y,adjustQuantity:Z,removeItem:ee,totalItems:Q,form:n}),e.jsxs("div",{className:"flex flex-col w-full gap-4",children:[e.jsxs("div",{className:"flex items-baseline justify-between",children:[e.jsx("h1",{className:"text-lg font-bold ",children:"Form Checkout"}),e.jsx(b,{type:"button",size:"sm",variant:"outline",onClick:()=>se(),className:`${te?"hidden":""} text-white bg-red-500 hover:bg-red-500 hover:text-white hover:opacity-85`,children:"Clear Form"})]}),e.jsx(ge,{className:"bg-slate-300 dark:bg-slate-700"}),e.jsx(g,{control:n.control,name:"customer_name",render:({field:t,fieldState:a})=>e.jsxs(p,{children:[e.jsxs(j,{className:a.error?"text-red-500":"dark:text-gray-300",children:["Customer name",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx(h,{children:e.jsx(w,{className:"dark:bg-slate-700",disabled:i,placeholder:"Panjul",...t})}),e.jsx(f,{className:"dark:text-red-500"})]})}),e.jsx(g,{control:n.control,name:"notes",render:({field:t,fieldState:a})=>e.jsxs(p,{children:[e.jsx(j,{className:a.error?"text-red-500":"dark:text-gray-300",children:"Notes"}),e.jsx(h,{children:e.jsx(pe,{className:"w-full h-32 max-w-lg max-h-40 dark:bg-slate-700",disabled:i,placeholder:".....",...t})}),e.jsx(f,{className:"dark:text-red-500"})]})}),e.jsx(g,{control:n.control,name:"order_date",render:({field:t,fieldState:a})=>e.jsxs(p,{children:[e.jsx(j,{className:a.error?"text-red-500":"dark:text-gray-300",children:"Order Date"}),e.jsx(h,{children:e.jsxs(ae,{children:[e.jsx(oe,{asChild:!0,children:e.jsxs(b,{variant:"outline",className:fe("w-full justify-start gap-3 p-5 text-left font-normal dark:bg-slate-600 dark:hover:bg-slate-600",!t.value&&"text-muted-foreground"),children:[e.jsx(ne,{}),t.value?ve(t.value,"PPP"):e.jsx("span",{children:"Pick a date"})]})}),e.jsx(de,{className:"w-auto p-0",children:e.jsx(le,{mode:"single",selected:t.value,onSelect:t.onChange,initialFocus:!0})})]})}),e.jsx(f,{className:"dark:text-red-500"})]})}),e.jsx("div",{className:"hidden",children:e.jsx(g,{control:n.control,name:"total_amount",render:({field:t,fieldState:a})=>e.jsxs(p,{children:[e.jsx(j,{className:a.error?"text-red-500":"dark:text-gray-300",children:"Total amount"}),e.jsx(h,{children:e.jsx(w,{className:"dark:bg-slate-700",type:"number",disabled:!0,...t})}),e.jsx(f,{className:"dark:text-red-500"})]})})}),e.jsx(g,{control:n.control,name:"payment_method_id",render:({field:t,fieldState:a})=>e.jsxs(p,{children:[e.jsxs(j,{className:a.error?"text-red-500":"dark:text-gray-300",children:["Payment method",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs(E,{disabled:i,onValueChange:r=>{t.onChange(r),Y(r)},value:t.value.toString(),defaultValue:t.value.toString(),children:[e.jsx(h,{className:"dark:bg-slate-700",children:e.jsx(M,{className:"w-full",children:e.jsx(B,{defaultValue:t.value.toString(),placeholder:"Select a payment method"})})}),e.jsx(J,{children:u.filter(r=>r.status).map(r=>e.jsxs(k,{value:r.id.toString(),children:[r.name,r.name=="Cash"?"":` - ${r.bank_name}`]},r.id.toString()))})]}),e.jsx(f,{className:"dark:text-red-500"})]})}),(()=>{switch(F){case"Cash":return e.jsx(g,{control:n.control,name:"changes",render:({field:t,fieldState:a})=>e.jsxs(p,{children:[e.jsx(j,{className:a.error?"text-red-500":"dark:text-gray-300",children:"Changes"}),e.jsx(h,{children:e.jsx(w,{className:"dark:bg-slate-700",type:"number",disabled:i,...t})}),e.jsx(f,{className:"dark:text-red-500"})]})});case"QRIS":return e.jsxs(e.Fragment,{children:[e.jsx(b,{onClick:()=>P(!0),type:"button",variant:"outline",className:"text-white bg-sky-500 hover:bg-sky-500 hover:text-white hover:opacity-85",children:"Show QR code"}),e.jsx(ke,{paymentMethodId:n.getValues("payment_method_id"),paymentMethods:u,isVisible:A,onClose:()=>P(!1)})]});case"Bank Transfer":return e.jsx(be,{paymentMethodId:n.getValues("payment_method_id"),paymentMethods:u});default:return null}})(),e.jsx(g,{control:n.control,name:"status",render:({field:t,fieldState:a})=>e.jsxs(p,{children:[e.jsxs(j,{className:a.error?"text-red-500":"dark:text-gray-300",children:["Payment Status",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx(h,{children:e.jsxs(E,{disabled:i,onValueChange:t.onChange,value:t.value,defaultValue:"completed",children:[e.jsx(h,{className:"dark:bg-slate-700",children:e.jsx(M,{className:"w-full",children:e.jsx(B,{defaultValue:t.value,placeholder:"Select a payment status"})})}),e.jsxs(J,{children:[e.jsx(k,{value:"completed",children:"Completed"}),e.jsx(k,{value:"pending",children:"Pending"}),e.jsx(k,{value:"cancelled",children:"Cancelled"})]})]})}),e.jsx(f,{className:"dark:text-red-500"})]})}),e.jsxs("div",{className:"flex flex-col items-center justify-between w-full gap-4 mt-5 lg:flex-row",children:[e.jsx(b,{disabled:i,className:"w-full",type:"submit",onClick:()=>T(!1),children:W}),e.jsx(b,{disabled:i,className:`${s?"hidden":""} w-full bg-slate-300 text-slate-950 hover:bg-slate-200 dark:bg-slate-700 dark:text-slate-200`,type:"submit",onClick:()=>T(!0),children:"Create & Create another"})]})]})]})})})]})};export{et as OrderForm};
