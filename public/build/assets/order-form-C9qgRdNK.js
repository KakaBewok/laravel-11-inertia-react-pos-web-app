import{r as l,j as e,y as I}from"./app-D9pFrhhQ.js";import{B as S}from"./button-FegJZZ0G.js";import{P as oe,a as ne,C as de,b as ce,c as me}from"./popover-zpcIQobc.js";import{o as le,s as N,g as ue,f as O,u as he,t as xe,F as ie,a as i,b as g,c as p,d as h,e as j}from"./index-CEMmep7m.js";import{H as ge}from"./heading-COvbuDjO.js";import{I as w}from"./input-CrCVKbUg.js";import{S as E,a as M,b as B,d as J,e as k}from"./select-DApvIETE.js";import{S as pe}from"./separator-BWGSZe6A.js";import{T as je}from"./textarea-Ni62unaQ.js";import{u as fe}from"./useGlobalContext-D4zjIaB6.js";import{c as ye}from"./utils-CcFn7B-c.js";import{B as L}from"./react-toastify.esm-DoOGIfX5.js";import{BankTransferCard as Se}from"./bank-transfer-card-DcHh4maf.js";import be from"./order-summary-GXicmBu4.js";import Ne from"./product-cards-C7Xya4YP.js";import{QrModal as ke}from"./qr-modal-B-vXDOt6.js";import{f as _e}from"./format-BEMO4FpZ.js";import"./index-B1AYJYdR.js";import"./createLucideIcon-BDk9GcPF.js";import"./react-icons.esm-BZ7oayWu.js";import"./index-CLx_H4vX.js";import"./index-DI3y1uhg.js";import"./index-Cud0KnTV.js";import"./index-CT1L61lC.js";import"./index-D7QuIRA-.js";import"./clsx-B-dksMZM.js";import"./constants-BUrVtmhx.js";import"./image-not-found-BCeE-Ta1.js";const ve=le({customer_name:N().min(3,{message:"Name must contain at least 3 character(s)"}),order_date:ue().refine(s=>{const u=new Date;u.setHours(0,0,0,0);const x=new Date(u);return x.setDate(u.getDate()+1),s<x},{message:"Order date cannot be tomorrow or in the future."}),total_amount:O.number().min(0,{message:"Total amount must be greater than or equal to 0"}),changes:O.number().min(0,{message:"Changes must be greater than or equal to 0"}),status:N().min(3,{message:"Status must contain at least 3 character(s)"}),notes:N().optional(),payment_method_id:N().min(1,{message:"Payment method is required"})}),et=({initialData:s,paymentMethods:u,products:x})=>{const{loading:f,setLoading:F}=fe(),[P,_]=l.useState(null),[Q,V]=l.useState(!1),[H,A]=l.useState(0),[q,R]=l.useState(0),[d,y]=l.useState(s&&s.selectedItems?s.selectedItems:[]),[T,$]=l.useState(""),z=x.filter(t=>t.name.toLowerCase().includes(T.toLowerCase())&&t.stock_quantity>0),G=s?"Edit order":"Create order",K=s?"Edit an order":"Add a new order",U=s?"Order updated.":"Order created.",W=s?"Save changes":"Create",v={customer_name:"",order_date:new Date,total_amount:q,changes:0,status:"",notes:"",payment_method_id:""},n=he({resolver:xe(ve),defaultValues:{customer_name:(s==null?void 0:s.customer_name)||"",order_date:(s==null?void 0:s.order_date)||new Date,total_amount:(s==null?void 0:s.total_amount)||q,changes:(s==null?void 0:s.changes)||0,status:(s==null?void 0:s.status)||"",notes:(s==null?void 0:s.notes)||"",payment_method_id:(s==null?void 0:s.payment_method_id)||""}}),C=n.watch(),X=t=>{F(!0);const r=t.order_date.toLocaleDateString("en-CA"),a=()=>{n.reset(),localStorage.removeItem("selectedItems"),localStorage.removeItem("formData"),localStorage.removeItem("paymentMethodName")},o=()=>{I.visit(route("admin.order.index")),setTimeout(()=>{L.success(U,{position:"top-center"}),a()},1e3)},c=m=>{Object.keys(m).forEach(re=>{const ae=m[re];L.error(ae,{position:"top-center"})})},b=()=>F(!1);s?I.post(route("admin.order.update",s==null?void 0:s.id),{...t,order_date:r,items:[...d.map(m=>({product_id:m.id,quantity:m.quantity}))],_method:"PATCH"},{onSuccess:o,onError:c,onFinish:b}):I.post(route("admin.order.store"),{...t,order_date:r,items:[...d.map(m=>({product_id:m.id,quantity:m.quantity}))]},{onSuccess:o,onError:c,onFinish:b})},Y=t=>{const r=u.find(a=>a.id.toString()===t);_((r==null?void 0:r.name)??null)},Z=(t,r)=>{const a=x.find(o=>o.id==t.id);a&&y(d.map(o=>{if(o.id===t.id){let c=o.quantity+r;return c=Math.min(c,a.stock_quantity),c=Math.max(c,0),{...o,quantity:c}}return o}).filter(o=>o.quantity>0))},D=t=>{const r=d.find(a=>a.id===t.id);y(r?d.map(a=>a.id===t.id?{...a,quantity:Math.min(a.quantity+1,t.stock_quantity)}:a):[...d,{id:t.id,product_name:t.name,price:t.price,unit:t.unit,quantity:1,total_price:t.price,photos:t.photos}])},ee=t=>{y(d.filter(r=>r.id!==t.id))};l.useEffect(()=>{const t=d.reduce((a,o)=>a+o.price*o.quantity,0),r=d.reduce((a,o)=>a+o.quantity,0);n.setValue("total_amount",t),R(t),A(r)},[d,n.setValue]),l.useEffect(()=>{if(!s){const t=localStorage.getItem("selectedItems"),r=localStorage.getItem("formData"),a=localStorage.getItem("paymentMethodName");if(t){const c=JSON.parse(t).filter(b=>x.some(m=>m.id===b.id));y(c)}if(r){const o=JSON.parse(r);o.order_date&&(o.order_date=new Date(o.order_date)),n.reset(o)}a&&_(JSON.parse(a)??null)}},[]),l.useEffect(()=>{s||(localStorage.setItem("selectedItems",JSON.stringify(d)),localStorage.setItem("formData",JSON.stringify(C)),localStorage.setItem("paymentMethodName",JSON.stringify(P)))},[d,C]);const te=Object.keys(v).every(t=>{const r=v[t],a=C[t];return r instanceof Date&&a instanceof Date?r.toDateString()===a.toDateString():a===r}),se=()=>{n.reset(v),_("")};return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(ge,{title:G,description:K}),e.jsx(S,{variant:"outline",onClick:()=>window.history.back(),className:"dark:bg-slate-200 dark:text-slate-900",children:"Back"})]}),e.jsx(Ne,{searchTerm:T,setSearchTerm:$,filteredProducts:z,addItem:D}),e.jsx(ie,{...n,children:e.jsx("form",{onSubmit:n.handleSubmit(X),className:"w-full p-8 space-y-8 rounded-md bg-slate-50 dark:bg-gradient-to-tr md:dark:bg-gradient-to-br dark:from-slate-950 dark:via-slate-900 dark:to-slate-800",children:e.jsxs("div",{className:"grid w-full grid-cols-1 gap-4 md:gap-20 md:grid-cols-2",children:[e.jsx(be,{products:x,selectedItems:d,setSelectedItems:y,adjustQuantity:Z,removeItem:ee,totalItems:H,form:n}),e.jsxs("div",{className:"flex flex-col w-full gap-4",children:[e.jsxs("div",{className:"flex items-baseline justify-between",children:[e.jsx("h1",{className:"text-lg font-bold ",children:"Form Checkout"}),e.jsx(S,{type:"button",size:"sm",variant:"outline",onClick:()=>se(),className:`${te?"hidden":""} text-white bg-red-500 hover:bg-red-500 hover:text-white hover:opacity-85`,children:"Clear Form"})]}),e.jsx(pe,{className:"bg-slate-300 dark:bg-slate-700"}),e.jsx(i,{control:n.control,name:"customer_name",render:({field:t,fieldState:r})=>e.jsxs(g,{children:[e.jsxs(p,{className:r.error?"text-red-500":"dark:text-gray-300",children:["Customer name",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx(h,{children:e.jsx(w,{className:"dark:bg-slate-700",disabled:f,placeholder:"Kevin Diks",...t})}),e.jsx(j,{className:"dark:text-red-500"})]})}),e.jsx(i,{control:n.control,name:"notes",render:({field:t,fieldState:r})=>e.jsxs(g,{children:[e.jsx(p,{className:r.error?"text-red-500":"dark:text-gray-300",children:"Notes"}),e.jsx(h,{children:e.jsx(je,{className:"w-full h-32 max-w-lg max-h-40 dark:bg-slate-700",disabled:f,placeholder:".....",...t})}),e.jsx(j,{className:"dark:text-red-500"})]})}),e.jsx(i,{control:n.control,name:"order_date",render:({field:t,fieldState:r})=>e.jsxs(g,{children:[e.jsx(p,{className:r.error?"text-red-500":"dark:text-gray-300",children:"Order Date"}),e.jsx(h,{children:e.jsxs(oe,{children:[e.jsx(ne,{asChild:!0,children:e.jsxs(S,{variant:"outline",className:ye("w-full justify-start gap-3 p-5 text-left font-normal dark:bg-slate-600 dark:hover:bg-slate-600",!t.value&&"text-muted-foreground"),children:[e.jsx(de,{}),t.value?_e(t.value,"PPP"):e.jsx("span",{children:"Pick a date"})]})}),e.jsx(ce,{className:"w-auto p-0",children:e.jsx(me,{mode:"single",selected:t.value,onSelect:t.onChange,initialFocus:!0})})]})}),e.jsx(j,{className:"dark:text-red-500"})]})}),e.jsx("div",{className:"hidden",children:e.jsx(i,{control:n.control,name:"total_amount",render:({field:t,fieldState:r})=>e.jsxs(g,{children:[e.jsx(p,{className:r.error?"text-red-500":"dark:text-gray-300",children:"Total amount"}),e.jsx(h,{children:e.jsx(w,{className:"dark:bg-slate-700",type:"number",disabled:!0,...t})}),e.jsx(j,{className:"dark:text-red-500"})]})})}),e.jsx(i,{control:n.control,name:"payment_method_id",render:({field:t,fieldState:r})=>e.jsxs(g,{children:[e.jsxs(p,{className:r.error?"text-red-500":"dark:text-gray-300",children:["Payment method",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs(E,{disabled:f,onValueChange:a=>{t.onChange(a),Y(a)},value:t.value.toString(),defaultValue:t.value.toString(),children:[e.jsx(h,{className:"dark:bg-slate-700",children:e.jsx(M,{className:"w-full",children:e.jsx(B,{defaultValue:t.value.toString(),placeholder:"Select a payment method"})})}),e.jsx(J,{children:u.filter(a=>a.status).map(a=>e.jsxs(k,{value:a.id.toString(),children:[a.name,a.name=="Cash"?"":` - ${a.bank_name}`]},a.id.toString()))})]}),e.jsx(j,{className:"dark:text-red-500"})]})}),(()=>{switch(P){case"Cash":return e.jsx(i,{control:n.control,name:"changes",render:({field:t,fieldState:r})=>e.jsxs(g,{children:[e.jsx(p,{className:r.error?"text-red-500":"dark:text-gray-300",children:"Changes"}),e.jsx(h,{children:e.jsx(w,{className:"dark:bg-slate-700",type:"number",disabled:f,...t})}),e.jsx(j,{className:"dark:text-red-500"})]})});case"QRIS":return e.jsxs(e.Fragment,{children:[e.jsx(S,{onClick:()=>V(!0),type:"button",variant:"outline",className:"text-white bg-sky-500 hover:bg-sky-500 hover:text-white hover:opacity-85",children:"Show QR code"}),e.jsx(ke,{paymentMethodId:n.getValues("payment_method_id"),paymentMethods:u,isVisible:Q,onClose:()=>V(!1)})]});case"Bank Transfer":return e.jsx(Se,{paymentMethodId:n.getValues("payment_method_id"),paymentMethods:u});default:return null}})(),e.jsx(i,{control:n.control,name:"status",render:({field:t,fieldState:r})=>e.jsxs(g,{children:[e.jsxs(p,{className:r.error?"text-red-500":"dark:text-gray-300",children:["Payment Status",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx(h,{children:e.jsxs(E,{disabled:f,onValueChange:t.onChange,value:t.value,defaultValue:"completed",children:[e.jsx(h,{className:"dark:bg-slate-700",children:e.jsx(M,{className:"w-full",children:e.jsx(B,{defaultValue:t.value,placeholder:"Select a payment status"})})}),e.jsxs(J,{children:[e.jsx(k,{value:"Paid",children:"Paid"}),e.jsx(k,{value:"Pending",children:"Pending"}),e.jsx(k,{value:"Cancelled",children:"Cancelled"})]})]})}),e.jsx(j,{className:"dark:text-red-500"})]})}),e.jsx(S,{disabled:f,className:"w-full mt-6",type:"submit",children:W})]})]})})})]})};export{et as OrderForm};
